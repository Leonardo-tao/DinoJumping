{"ast":null,"code":"export default {\n  name: 'playGame',\n  data() {\n    return {\n      ctx: null,\n      canvasWidth: 2400,\n      canvasHeight: 100,\n      speed: 0,\n      groundX: -10,\n      isRunning: false,\n      // 标志是否开始移动\n      currentLeg: 'left',\n      // 当前小恐龙腿的状态\n      legTimer: null,\n      // 控制左右脚切换的定时器\n      pace: 300,\n      //步频\n      isJumping: false,\n      // 跳跃状态\n      jumpHeight: 0,\n      // 当前跳跃高度\n      gravity: 0.5,\n      // 重力加速度\n      loadedImages: {},\n      // 存储加载后的图片\n      images: {\n        start: \"dino_start\",\n        ground: \"ground\",\n        left: \"dino_runl\",\n        right: \"dino_runr\",\n        jump: \"dino_start\"\n      }\n    };\n  },\n  methods: {\n    // 绘制图片\n    drawPic(pic, x, y, w, h) {\n      let img = this.loadedImages[pic]; // 使用已加载的图片\n\n      if (!img) return; // 如果图片尚未加载，直接返回\n\n      if (w === undefined) w = img.width;\n      if (h === undefined) h = img.height;\n      if (y === undefined) y = this.canvasHeight - h;\n      if (x === undefined) x = 0;\n      this.ctx.drawImage(img, x, y, w, h);\n    },\n    // 更新地面位置\n    updateGroundPosition() {\n      this.groundX -= this.speed;\n      if (this.groundX <= -this.canvasWidth) {\n        this.groundX = 0;\n      }\n    },\n    // 动画函数\n    animate() {\n      this.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);\n\n      // 绘制地面和小恐龙\n      this.drawPic('ground', this.groundX, this.canvasHeight - 26);\n      this.drawPic('ground', this.groundX + this.canvasWidth, this.canvasHeight - 26);\n      const dinoY = this.isJumping ? 40 - this.jumpHeight : 40;\n      this.drawPic(this.isRunning ? this.currentLeg : 'start', 10, dinoY, 52, 52); // 根据跳跃状态调整y坐标\n\n      this.updateGroundPosition();\n      this.updateJump(); // 更新跳跃状态\n\n      requestAnimationFrame(this.animate.bind(this));\n    },\n    handleKeyDown(e) {\n      if (e.key === 'Enter' && !this.isRunning) {\n        this.isRunning = true;\n        this.speed = 1;\n        this.startRunning(); // 启动小恐龙跑步\n      }\n      if (e.key === ' ' && !this.isJumping) {\n        // 按下空格键\n        this.isJumping = true; // 标记为正在跳跃\n        this.jumpHeight = 0; // 重置跳跃高度\n      }\n    },\n    accelerate() {\n      this.speed += 0.01;\n      this.pace -= 1;\n    },\n    updateJump() {\n      if (this.isJumping) {\n        this.jumpHeight += this.gravity; // 增加跳跃高度\n\n        // 当跳跃达到一定高度后，开始下降\n        if (this.jumpHeight > 50) {\n          // 设定跳跃高度阈值\n          this.gravity = -0.7; // 反向重力，实现下降\n        }\n\n        // 检查是否回到地面\n        if (this.jumpHeight <= 0) {\n          this.jumpHeight = 0; // 重置高度\n          this.isJumping = false; // 跳跃结束\n          this.gravity = 0.5; // 重置重力加速度\n        }\n      }\n    },\n    // 开始跑步，地面移动 + 小恐龙切换左右脚\n    startRunning() {\n      // 开始切换左右脚\n      this.legTimer = setInterval(() => {\n        this.currentLeg = this.currentLeg === 'left' ? 'right' : 'left';\n      }, this.pace); // 每300ms切换一次\n\n      // 地面开始移动\n      this.speed = 2; // 设置初始速度\n      this.accelerate(); //设置加速\n    }\n  },\n  mounted() {\n    this.ctx = document.getElementById('canvas').getContext(\"2d\");\n\n    // 预加载图片资源\n    const imagePromises = Object.entries(this.images).map(([key, imageSrc]) => {\n      return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.src = require(`/src/assets/images/${imageSrc}.png`);\n        img.onload = () => {\n          this.loadedImages[key] = img; // 存储已加载的图片\n          resolve();\n        };\n        img.onerror = () => {\n          console.error(`加载图片失败: ${img.src}`);\n          reject();\n        };\n      });\n    });\n\n    // 监听键盘事件\n    window.addEventListener('keydown', this.handleKeyDown);\n\n    // 确保所有图片资源加载完成后再启动动画\n    Promise.all(imagePromises).then(() => {\n      this.animate(); // 所有图片加载完成后启动动画\n    }).catch(error => {\n      console.error(\"图片加载失败：\", error);\n    });\n  },\n  unmounted() {\n    if (this.legTimer) {\n      clearInterval(this.legTimer);\n    }\n    window.removeEventListener('keydown', this.handleKeyDown);\n  }\n};","map":{"version":3,"names":["name","data","ctx","canvasWidth","canvasHeight","speed","groundX","isRunning","currentLeg","legTimer","pace","isJumping","jumpHeight","gravity","loadedImages","images","start","ground","left","right","jump","methods","drawPic","pic","x","y","w","h","img","undefined","width","height","drawImage","updateGroundPosition","animate","clearRect","dinoY","updateJump","requestAnimationFrame","bind","handleKeyDown","e","key","startRunning","accelerate","setInterval","mounted","document","getElementById","getContext","imagePromises","Object","entries","map","imageSrc","Promise","resolve","reject","Image","src","require","onload","onerror","console","error","window","addEventListener","all","then","catch","unmounted","clearInterval","removeEventListener"],"sources":["E:\\code\\Web\\dino\\src\\components\\game.vue"],"sourcesContent":["<template>\n  <div class=\"game\">\n    <canvas id=\"canvas\" :width=\"canvasWidth\" :height=\"canvasHeight\" />\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'playGame',\n  data() {\n    return {\n      ctx: null,\n      canvasWidth: 2400,\n      canvasHeight: 100,\n      speed: 0,\n      groundX: -10,\n      isRunning: false,  // 标志是否开始移动\n      currentLeg: 'left', // 当前小恐龙腿的状态\n      legTimer: null,     // 控制左右脚切换的定时器\n      pace: 300,      //步频\n      isJumping: false, // 跳跃状态\n      jumpHeight: 0, // 当前跳跃高度\n      gravity: 0.5, // 重力加速度\n      loadedImages: {}, // 存储加载后的图片\n      images: {\n        start: \"dino_start\",\n        ground: \"ground\",\n        left: \"dino_runl\",\n        right: \"dino_runr\",\n        jump: \"dino_start\"\n      }\n    }\n  },\n  methods: {\n    // 绘制图片\n    drawPic(pic, x, y, w, h) {\n      let img = this.loadedImages[pic] // 使用已加载的图片\n\n      if (!img) return // 如果图片尚未加载，直接返回\n\n      if (w === undefined) w = img.width\n      if (h === undefined) h = img.height\n      if (y === undefined) y = this.canvasHeight - h\n      if (x === undefined) x = 0\n\n      this.ctx.drawImage(img, x, y, w, h)\n    },\n    // 更新地面位置\n    updateGroundPosition() {\n      this.groundX -= this.speed\n\n      if (this.groundX <= -this.canvasWidth) {\n        this.groundX = 0\n      }\n\n    },\n    // 动画函数\n    animate() {\n      this.ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n\n      // 绘制地面和小恐龙\n      this.drawPic('ground', this.groundX, this.canvasHeight - 26)\n      this.drawPic('ground', this.groundX + this.canvasWidth, this.canvasHeight - 26)\n      const dinoY = this.isJumping ? (40 - this.jumpHeight) : 40;\n\n      this.drawPic(this.isRunning ? this.currentLeg : 'start', 10,dinoY, 52, 52);  // 根据跳跃状态调整y坐标\n\n      this.updateGroundPosition()\n      this.updateJump(); // 更新跳跃状态\n\n\n      requestAnimationFrame(this.animate.bind(this))\n    },\n    handleKeyDown(e) {\n      if (e.key === 'Enter' && !this.isRunning) {\n        this.isRunning = true\n        this.speed = 1\n        this.startRunning() // 启动小恐龙跑步\n      }\n\n      if (e.key === ' ' && !this.isJumping) { // 按下空格键\n        this.isJumping = true; // 标记为正在跳跃\n        this.jumpHeight = 0; // 重置跳跃高度\n      }\n    },\n    accelerate() {\n      this.speed += 0.01\n      this.pace -= 1\n    },\n    updateJump() {\n      if (this.isJumping) {\n        this.jumpHeight += this.gravity; // 增加跳跃高度\n\n        // 当跳跃达到一定高度后，开始下降\n        if (this.jumpHeight > 50) { // 设定跳跃高度阈值\n          this.gravity = -0.7; // 反向重力，实现下降\n        }\n\n        // 检查是否回到地面\n        if (this.jumpHeight <= 0) {\n          this.jumpHeight = 0; // 重置高度\n          this.isJumping = false; // 跳跃结束\n          this.gravity = 0.5; // 重置重力加速度\n        }\n      }\n    },\n\n    // 开始跑步，地面移动 + 小恐龙切换左右脚\n    startRunning() {\n      // 开始切换左右脚\n      this.legTimer = setInterval(() => {\n        this.currentLeg = this.currentLeg === 'left' ? 'right' : 'left'\n      }, this.pace) // 每300ms切换一次\n\n      // 地面开始移动\n      this.speed = 2 // 设置初始速度\n      this.accelerate() //设置加速\n    }\n  },\n\n  mounted() {\n    this.ctx = document.getElementById('canvas').getContext(\"2d\")\n\n    // 预加载图片资源\n    const imagePromises = Object.entries(this.images).map(([key, imageSrc]) => {\n      return new Promise((resolve, reject) => {\n        const img = new Image()\n        img.src = require(`/src/assets/images/${imageSrc}.png`)\n\n        img.onload = () => {\n          this.loadedImages[key] = img // 存储已加载的图片\n          resolve()\n        }\n\n        img.onerror = () => {\n          console.error(`加载图片失败: ${img.src}`)\n          reject()\n        }\n      })\n    })\n\n    // 监听键盘事件\n    window.addEventListener('keydown', this.handleKeyDown)\n\n    // 确保所有图片资源加载完成后再启动动画\n    Promise.all(imagePromises)\n      .then(() => {\n        this.animate() // 所有图片加载完成后启动动画\n      })\n      .catch(error => {\n        console.error(\"图片加载失败：\", error)\n      })\n  },\n  unmounted() {\n    if (this.legTimer) {\n      clearInterval(this.legTimer)\n    }\n    window.removeEventListener('keydown', this.handleKeyDown)\n  }\n\n}\n</script>\n\n<style scoped>\n#canvas {\n  background-color: #000;\n  border: 1px solid #000\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}